<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calon Mantu Idaman - PvP</title>
    <style>
        /* --- RESET & LAYOUT --- */
        body {
            margin: 0; padding: 0;
            background-color: #222;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            height: 100dvh;
            user-select: none; /* Mencegah blok teks saat main cepat */
        }

        #game-container {
            position: relative;
            height: 100%;
            aspect-ratio: 9/16;
            background-image: url('https://res.cloudinary.com/dsutaioqw/image/upload/v1770514507/board_gukevw.png');
            background-size: contain; background-repeat: no-repeat; background-position: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }

        /* --- UI ATAS (AVATAR & STATS) --- */
        .avatar-box {
            position: absolute;
            top: 7.3%; /* KEMBALI KE POSISI AWAL */
            width: 13.5%; aspect-ratio: 1/1;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background-color: #ddd; background-size: cover;
            border: 2px solid white;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
            z-index: 5;
            transition: transform 0.3s;
        }
        /* EFEK GILIRAN AKTIF (Zoom dikit) */
        .active-turn { transform: translate(-50%, -50%) scale(1.2); border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; }

        /* POSISI DITUKAR SESUAI REQUEST */
        #p1-avatar { left: 11.5%; background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=ffdfbf'); } /* KIRI */
        #p2-avatar { left: 88.5%; background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=Grandma&backgroundColor=b6e3f4'); } /* KANAN */

        .stat-box {
            position: absolute;
            top: 7.3%; /* KEMBALI KE POSISI AWAL */
            transform: translate(-50%, -50%);
            width: 16%; text-align: center;
            font-size: 2.1vh; font-weight: 800; color: #5d4037;
            z-index: 6; letter-spacing: -0.5px;
        }
        #ui-hati { left: 38.0%; } 
        #ui-uang { left: 64.0%; } 

        /* --- BIDAK --- */
        .pion {
            position: absolute;
            width: 7%; aspect-ratio: 1/1;
            border-radius: 50%; border: 3px solid #fff;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10; transform: translate(-50%, -50%);
        }
        #p1-token { background: #3498db; }
        #p2-token { background: #e74c3c; transform: translate(-30%, -30%) scale(0.8); }

        /* --- TOAST & NOTIFIKASI (PENGGANTI ALERT) --- */
        #toast-container {
            position: absolute; top: 18%; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; gap: 5px; align-items: center;
            z-index: 99; width: 80%;
        }
        .toast-msg {
            background: rgba(0,0,0,0.85); color: white; padding: 8px 16px;
            border-radius: 20px; font-size: 1.6vh; 
            animation: fadeInOut 2.5s forwards; border: 1px solid rgba(255,255,255,0.2);
        }
        @keyframes fadeInOut { 0% {opacity:0; transform:translateY(-10px);} 10% {opacity:1; transform:translateY(0);} 90% {opacity:1;} 100% {opacity:0; display:none;} }

        /* --- CARD POPUP --- */
        #card-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center;
            z-index: 100; backdrop-filter: blur(4px);
        }
        .game-card {
            width: 75%; aspect-ratio: 2/3; border-radius: 15px; padding: 20px;
            text-align: center; display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 4px solid white;
            animation: cardPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes cardPop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .card-green { background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%); color: #006442; }
        .card-yellow { background: linear-gradient(135deg, #fce38a 0%, #f38181 100%); color: #854200; }
        .card-red { background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%); color: #520002; }
        .card-orange { background: linear-gradient(135deg, #FFB75E 0%, #ED8F03 100%); color: #632c00; }

        .card-title { font-size: 2.5vh; font-weight: 900; text-transform: uppercase; border-bottom: 2px solid rgba(0,0,0,0.1); padding-bottom: 10px;}
        .card-body { font-size: 2.2vh; font-weight: 600; flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .card-btn { margin-top: 15px; padding: 12px; background: white; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; color: #333; }

        /* --- CONTROLS --- */
        .btn-area { position: absolute; z-index: 20; cursor: pointer; border-radius: 15px; }
        #btn-kocok { bottom: 3.5%; left: 50%; transform: translateX(-50%); width: 42%; height: 10%; border-radius: 40px; }
        #btn-kocok:active { background: rgba(255,255,255,0.2); }
        
        #btn-kartu-menu { bottom: 5%; left: 5%; width: 20%; height: 10%; } 

        /* INDICATOR GILIRAN */
        #turn-bar {
            position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%);
            background: #3498db; color: white; padding: 5px 20px; border-radius: 15px;
            font-size: 1.8vh; font-weight: bold; box-shadow: 0 4px 0 #2980b9;
            transition: background 0.3s; z-index: 30;
        }

        /* INVENTORY MODAL */
        #inventory-list {
            position: absolute; bottom: 16%; left: 5%; width: 45%; 
            background: white; border-radius: 10px; padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: none; z-index: 95;
            font-size: 1.5vh; border: 2px solid #333;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="p1-avatar" class="avatar-box active-turn"></div> <div id="p2-avatar" class="avatar-box"></div> <div id="ui-hati" class="stat-box">0</div>
    <div id="ui-uang" class="stat-box">20</div>

    <div id="p1-token" class="pion"></div>
    <div id="p2-token" class="pion"></div>

    <div id="toast-container"></div>
    <div id="turn-bar">Giliran: KAMU (P1)</div>
    
    <div id="card-overlay">
        <div id="active-card" class="game-card card-green">
            <div class="card-title" id="card-title">JUDUL</div>
            <div class="card-body" id="card-desc">Deskripsi</div>
            <div style="background:rgba(255,255,255,0.4); padding:5px; border-radius:5px;" id="card-eff">Efek</div>
            <button class="card-btn" onclick="closeCard()">AMBIL</button>
        </div>
    </div>

    <div id="inventory-list">
        <b>Tas Item:</b>
        <ul id="inv-ul" style="padding-left: 20px; margin: 5px 0;"><li>(Kosong)</li></ul>
    </div>

    <div id="btn-kocok" class="btn-area" onclick="mainkanGiliran()"></div>
    <div id="btn-kartu-menu" class="btn-area" onclick="toggleInventory()"></div>
</div>

<script>
    // --- 1. KOORDINAT GRID (Fix) ---
    const tiles = [
        { id: 0, x: 11.0, y: 68.3, type: "start", name: "START" },
        { id: 1, x: 30.5, y: 68.3, type: "martabak", name: "Martabak" },
        { id: 2, x: 50.0, y: 68.3, type: "chance", name: "Kesempatan" },
        { id: 3, x: 69.5, y: 68.3, type: "puji", name: "Puji Masakan" },
        { id: 4, x: 89.0, y: 68.3, type: "safe", name: "Pos Ronda" },
        { id: 5, x: 89.0, y: 57.1, type: "trap", name: "Supir Dadakan" },
        { id: 6, x: 89.0, y: 45.8, type: "tax", name: "Pajak THR" },
        { id: 7, x: 89.0, y: 34.5, type: "special", name: "Kartu Spesial" },
        { id: 8, x: 89.0, y: 23.2, type: "jail", name: "RSJ Stress" },
        { id: 9, x: 69.5, y: 23.2, type: "gamble_roof", name: "Genteng" },
        { id: 10, x: 50.0, y: 23.2, type: "gamble_gold", name: "Toko Emas" },
        { id: 11, x: 30.5, y: 23.2, type: "prank", name: "Prank Sosial" },
        { id: 12, x: 11.0, y: 23.2, type: "extreme", name: "Kartu Ekstrem" },
        { id: 13, x: 11.0, y: 34.5, type: "bad", name: "Mantan Datang" },
        { id: 14, x: 11.0, y: 45.8, type: "bad_pay", name: "Kapan Nikah" },
        { id: 15, x: 11.0, y: 57.1, type: "climax", name: "Nekat Melamar" }
    ];

    // --- 2. DATABASE KARTU ---
    const decks = {
        chance: [
            { title: "Nemu Duit", desc: "Rejeki anak soleh!", eff: "uang", val: 5, text: "+5 Uang" },
            { title: "Salah Kostum", desc: "Pakai piyama ke kondangan.", eff: "hati", val: -3, text: "-3 Hati" }
        ],
        extreme: [
            { title: "Camer PMS", desc: "Senggol bacok mode on.", eff: "hati", val: -10, text: "-10 Hati" },
            { title: "Krisis Moneter", desc: "Dompet hilang!", eff: "uang_half", val: 0, text: "Uang Sisa 50%" }
        ],
        special: [
            { title: "Surat Dokter", desc: "Bebas dari kerja paksa.", eff: "item", id: "item_skip" },
            { title: "Anti Omelan", desc: "Tangkal serangan mental.", eff: "item", id: "item_shield" }
        ]
    };

    // --- 3. STATE GAME (PvP MODE) ---
    // Sekarang ada p1 dan p2 (bukan cpu)
    let p1 = { id: 1, name: "KAMU (P1)", pos: 0, uang: 20, hati: 0, jailed: false, items: [], color: "#3498db" };
    let p2 = { id: 2, name: "TEMAN (P2)", pos: 0, uang: 20, hati: 0, jailed: false, items: [], color: "#e74c3c" };
    
    let turnP1 = true; // Giliran siapa?
    let isMoving = false;
    
    // Init Visual
    updateVisuals();
    updateStatsUI(p1); // Tampilkan stat P1 di awal

    // --- 4. ENGINE GAME ---
    function mainkanGiliran() {
        if (isMoving) return;
        
        let actor = turnP1 ? p1 : p2; // Siapa yang main?
        
        // Cek Penjara
        if (actor.jailed) {
            pushToast(`${actor.name} masih di RSJ! Skip.`);
            actor.jailed = false; 
            switchTurn();
            return;
        }

        isMoving = true;
        let dadu = Math.floor(Math.random() * 6) + 1;
        pushToast(`${actor.name} lempar Dadu: ${dadu}`);

        let steps = 0;
        let interval = setInterval(() => {
            actor.pos++;
            if (actor.pos >= 16) {
                actor.pos = 0;
                actor.uang += 10;
                pushToast("Lewat Start: +10 Uang");
            }
            updateVisuals();
            steps++;

            if (steps >= dadu) {
                clearInterval(interval);
                setTimeout(() => handleTile(actor), 500);
            }
        }, 250);
    }

    function handleTile(actor) {
        let tile = tiles[actor.pos];
        
        // EFEK KOTAK
        switch (tile.type) {
            case "martabak": actor.uang -= 3; actor.hati += 2; pushToast("Beli Martabak"); break;
            case "trap": pushToast("Supir Dadakan! Balik."); actor.pos = 1; updateVisuals(); break;
            case "tax": actor.uang -= 5; pushToast("Pajak THR -5"); break;
            case "jail": actor.jailed = true; pushToast("Masuk RSJ!"); break;
            case "prank": 
                if(Math.random()>0.5) { actor.uang+=15; actor.hati+=10; pushToast("Prank Viral! (+Rejeki)"); }
                else { actor.uang-=10; pushToast("Prank Dihujat! (-Uang)"); }
                break;
            case "gamble_gold":
                if(actor.uang>=10){
                    actor.uang-=10;
                    if(Math.random()>0.5){ actor.hati+=15; pushToast("Emas KW Laku!"); }
                    else { pushToast("Ketahuan Palsu!"); }
                } else { pushToast("Uang kurang."); }
                break;
            case "bad": actor.hati-=5; pushToast("Mantan Datang -5 Hati"); break;
            case "climax":
                if(Math.floor(Math.random()*6)+1 === 6) { alert(`${actor.name} MENANG!`); location.reload(); }
                else { actor.hati-=10; actor.pos=8; actor.jailed=true; pushToast("Ditolak! Masuk RSJ"); updateVisuals(); }
                break;
            // KARTU
            case "chance": drawCard("chance", "card-green", actor); return;
            case "special": drawCard("special", "card-yellow", actor); return;
            case "extreme": drawCard("extreme", "card-red", actor); return;
        }
        
        switchTurn();
    }

    // --- 5. LOGIC KARTU & ITEM ---
    function drawCard(deckKey, css, actor) {
        let deck = decks[deckKey];
        let card = deck[Math.floor(Math.random()*deck.length)];
        
        showCardUI(card, css, () => {
            if(card.eff === "uang") actor.uang += card.val;
            if(card.eff === "hati") actor.hati += card.val;
            if(card.eff === "uang_half") actor.uang = Math.floor(actor.uang/2);
            if(card.eff === "item") {
                actor.items.push(card.title);
                pushToast("Item disimpan ke Tas!"); // PENGGANTI ALERT
            }
            updateStatsUI(actor); // Update UI setelah efek kartu
            switchTurn();
        });
    }

    function showCardUI(card, css, cb) {
        document.getElementById('active-card').className = "game-card " + css;
        document.getElementById('card-title').innerText = card.title;
        document.getElementById('card-desc').innerText = card.desc;
        document.getElementById('card-eff').innerText = card.text || "Efek";
        document.getElementById('card-overlay').style.display = "flex";
        window.tempCb = cb;
    }
    function closeCard() {
        document.getElementById('card-overlay').style.display = "none";
        if(window.tempCb) window.tempCb();
    }

    // --- 6. SISTEM GILIRAN (PvP) ---
    function switchTurn() {
        isMoving = false;
        turnP1 = !turnP1; // Tukar giliran
        
        let nextPlayer = turnP1 ? p1 : p2;
        
        // Update UI Indikator Giliran
        let bar = document.getElementById('turn-bar');
        bar.innerText = `Giliran: ${nextPlayer.name}`;
        bar.style.background = nextPlayer.color;
        
        // Highlight Avatar Aktif
        document.getElementById('p1-avatar').classList.toggle('active-turn', turnP1);
        document.getElementById('p2-avatar').classList.toggle('active-turn', !turnP1);
        
        // Update Stats UI sesuai giliran pemain
        updateStatsUI(nextPlayer);
    }

    function updateStatsUI(actor) {
        document.getElementById('ui-uang').innerText = actor.uang;
        document.getElementById('ui-hati').innerText = actor.hati;
    }

    function updateVisuals() {
        // P1 Token
        let c1 = tiles[p1.pos];
        document.getElementById('p1-token').style.left = c1.x + "%";
        document.getElementById('p1-token').style.top = c1.y + "%";
        // P2 Token
        let c2 = tiles[p2.pos];
        document.getElementById('p2-token').style.left = c2.x + "%";
        document.getElementById('p2-token').style.top = c2.y + "%";
    }

    // Notifikasi Toast
    function pushToast(msg) {
        let div = document.createElement('div');
        div.className = "toast-msg";
        div.innerText = msg;
        document.getElementById('toast-container').appendChild(div);
        setTimeout(() => div.remove(), 2600);
    }

    // Inventory
    function toggleInventory() {
        let playerNow = turnP1 ? p1 : p2;
        let el = document.getElementById('inventory-list');
        let ul = document.getElementById('inv-ul');
        
        if (el.style.display === "block") {
            el.style.display = "none";
        } else {
            el.style.display = "block";
            ul.innerHTML = playerNow.items.length 
                ? playerNow.items.map(i => `<li>${i}</li>`).join('') 
                : "<li>(Kosong)</li>";
        }
    }
</script>
</body>
</html>
